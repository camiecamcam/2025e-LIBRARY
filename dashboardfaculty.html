
<!DOCTYPE html>

<html>
  

<head>
  <style>
   
    .top-bar {
       background-color: #01579B;
       color: #FFFFFF;
       padding: 5px;
       margin-top: auto;
       display: flex;
       justify-content: space-between;
       align-items: center;
       margin-left: auto;
       margin-right: auto;
   }

   .top-bar .title {
       font-size: 2rem;
       margin-left: 290px;
       font-weight: 600;
   }
   .top-bar .icons {
   display: flex;
   margin-top: 5px;
   margin-bottom: 5px;
   margin-right: 20px;
   align-items: center;
   gap: 2rem;
}


   .top-bar .icons img {
       width: 2rem;
       height: 2rem;
       border-radius: 50%;
       transition: background-color 0.3s ease-in-out, transform 0.3s ease-in-out;
       cursor: pointer;
   }

   .top-bar .icons img:hover {
       transform: scale(1.3);
   }



   .top-bar .icons .notification {
       position: relative;
   }

   .top-bar .icons .notification span {
       position: absolute;
       top: 0;
       right: 0;
       width: 1rem;
       height: 1rem;
       background-color: #0dff00;
       border-radius: 50%;
   }

   .sidebar {
 position: fixed;
 top: 0;
 bottom: 0;
 left: 0;
 width: 260px;
 background-color: #2C384A;
 color: #FFFFFF;
 padding: 1rem;
 display: flex;
 flex-direction: column;
 align-items: center;
 overflow-y: auto;
 scrollbar-width: thin; /* for Firefox */
 -ms-overflow-style: -ms-autohiding-scrollbar; /* for IE and Edge */
}

.sidebar .logo {
 font-size: 1.3rem;
 font-weight: 600;
 margin-bottom: 1rem;
}

.sidebar img {
 width: 170px;
 margin-bottom: 1rem;
}

.sidebar nav {
 flex-grow: 1;
 margin-top: 2rem;
}
.sidebar nav a1 {
       display: flex;
       align-items: center;
       padding: 0.3rem 0.3rem;
       color: #79aefd;
       text-decoration: none;
       transition: background-color 0.3s ease-in-out;
   }
  

.sidebar nav a {
 display: flex;
 align-items: center;
 padding: 0.3rem 0.3rem;
 color: #FFFFFF;
 text-decoration: none;
 transition: background-color 0.3s ease-in-out;
}

.sidebar nav a:hover {
 color: #79aefd;
}

.sidebar nav a img {
 width: 40px;
 height: 40px;
 margin-right: 1rem;
 margin-top: 20px;
}

.sidebar nav a span {
 font-size: 1rem;
 font-weight: 500;
}

   .main-content {
       margin-left: 260px;
       padding-left: 40px;
       padding-right: 20px;
       padding-bottom: 70px;
       margin-top: 1px;
   }

   .card {
       background-color: #FFFFFF;
       padding: 1rem;
       border: 1px solid #CCCCCC;
       border-radius: 10px;
       box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
   }

   .card h2 {
       margin-top: 0;
   }

   #chatheadsnotif {
   transition: transform 0.3s ease-in-out;
 }

 #chatheadsnotif:hover {
   transform: scale(1.2);
 }

 #chatheadsnotif.expanded {
   transform: scale(1.5);
 }

 #chatheadsnotif.expanded #chatheads {
   width: 80px;
   height: 80px;
 }

 #chatheadsnotif.expanded .absolute {
   bottom: -10px;
   right: -10px;
 }
   
 </style>
<style>
 #book-icon {
 transition: transform 0.5s; /* add transition effect */
}

#book-icon:hover {
 transform: scale(1.1); /* scale up by 10% on hover */
}

body {
 background-color: white;
     overflow: -moz-scrollbars-none;
     -ms-overflow-style: none;
}

:root {
 scrollbar-width: none !important;
}




.search-bar {
 width: 300px;
 position: absolute;
 top: 50; /* changed to 0 to make it on top */
 left: 50%;
 transform: translateX(-50%);
 z-index: 3; /* added to make it on top of everything */
}

#search-input {
 flex: 2;
 width: 400px;
 padding: 10px;
 color: black;
 font-size: 12px;
 border: none;
 border-radius: 10px 10px 10px 10px;
}

.sidebar nav a1:hover{
     color: #79aefd;
   }

   .sidebar nav a1 img {
       width: 40px;
       height: 40px;
       margin-right: 1rem;
       margin-top: 20px;
   }
  
   .sidebar nav a1 span {
       font-size: 1rem;
       font-weight: 500;
   }


.suggestions {
 position: absolute;
 top: 35px;
 background-color: #f9f9f9;
 border: 1px solid #ccc;
 padding: 10px;
 width: 400px;
 display: none;
 color: black;
 z-index: 3; /* added to make it on top of everything */
 overflow-y: auto; /* add this */
 max-height: 350px; /* or a fixed height */
}

.suggestions ul {
list-style: none;
 padding: 0;
 margin: 0;
}

.suggestions li {
 padding: 10px;
 border-bottom: 1px solid #ccc;
 display: flex;
 align-items: center;
}

.suggestion-photo {
 width: 30px;
 height: 30px;
 margin-right: 10px;
 border-radius: 50%;
}

.suggestions li:hover {
 background-color: #d1cfcf;
 cursor: pointer;
}

#search-input:focus + .suggestions {
 display: block;
}




.notification-panel {
 transform: translateX(100%);
 transition: transform 0.3s ease-in-out;
}

.notification-panel.show {
 transform: translateX(0);
}

.close-button {
 cursor: pointer;
}

.book-title {
   flex: 1;
   font-weight: bold;
   font-size: 1.2rem; /* Default font size */
   overflow: hidden;
   text-overflow: ellipsis;
   white-space: nowrap;
}

.book-title.long-title {
   font-size: 0.8rem; /* Smaller font size for long titles */
}
.book-title2 {
   flex: 1;
   font-weight: bold;
   font-size: 1.2rem; /* Default font size */
   overflow: hidden;
   text-overflow: ellipsis;
   white-space: nowrap;
}

.book-title2.long-title {
   font-size: 0.8rem; /* Smaller font size for long titles */
}

.image-container {
 display: flex;
 justify-content: center;
 align-items: center;
 width: 100%; /* Ensure full width */
 height: 100%; /* Ensure full height of the parent */
 overflow: hidden; /* Optional: Prevent overflow issues */
}

</style>

  </head>
  <div class="sidebar">
    <div class="logo">STI VIGAN E-LIBRARY</div>
    <img src="../image/sti logo 4 (2).png"  />
    <nav>
        <a1 href="/dashboardfaculty.html">
            <img src="../image/home.png" />
            <span>Dashboard</span>
        </a1>
        <a href="/catalogfaculty.html">
            <img src="../image/catalog.png"  />
            <span>Catalogs</span>
        </a>
        <a href="/studentsfaculty.html">
          <img src="../image/user (1).png" alt="Others Icon" />
          <span>Students</span>
         
      </a>
        <a href="/reportsfaculy.html">
            <img src="../image/reports.png" />
            <span>Reports</span>
        </a>
      
        <a href="#" id="logoutbutton">
          <img src="../image/logout.png"  />
          <span>Log-out</span>

        
      </a>
  
         
    </nav>
</div>

  <body>  
    <div class="top-bar">
      <div class="title">Dashboard</div>
      <div class="search-bar">
        <input id="search-input" type="text" placeholder="Search..." autocomplete="off" >
        <div class="suggestions">
          <ul>
            <!--BOOKS-->
            <p id="booksCollectiones"><b>Books</b></p>
            <li>
              <img id="books1" src="../image/icons8-books-48.png" alt="photo" class="suggestion-photo">
              <span id="book1-name"></span>
            </li>          
            <li>
              <img id="books2" src="../image/icons8-books-48.png" alt="photo" class="suggestion-photo">
              <span id="book2-name"></span>
            </li>   
            <li>
              <img id="books3" src="../image/icons8-books-48.png" alt="photo" class="suggestion-photo">
              <span id="book3-name"></span>
            </li>   
            <!--sTUDENTS-->
            <p id="studentCollectiones"><b>Students</b></p>
            <li>
              <img id="users1" src="../image/student.png" alt="photo" class="suggestion-photo">
              <span id="user1-name"></span>
            </li>   
            <li>
              <img id="users2" src="../image/student.png" alt="photo" class="suggestion-photo">
              <span id="user2-name"></span>
            </li>   
            <li>
              <img id="users3" src="../image/student.png" alt="photo" class="suggestion-photo">
              <span id="user3-name"></span>
            </li>
            <!--teachers-->
            <p id="teachersCollectiones"><b>Faculty</b></p>
            <li>
              <img id="teachers1" src="../image/teacher.png" alt="photo" class="suggestion-photo">
              <span id="teachers1-name"></span>
            </li>   
            <li>
              <img id="teachers2" src="../image/teacher.png" alt="photo" class="suggestion-photo">
              <span id="teachers2-name"></span>
            </li>   
            <li>
              <img id="teachers3" src="../image/teacher.png" alt="photo" class="suggestion-photo">
              <span id="teachers3-name"></span>
            </li>
          </ul>
        </div>
      </div>
      
      
      <div class="icons">
       
        
        
        <img  id="notificationbell"   src="../image/notification-bell-icon-free-vector.png" alt="search" />
        <div class="notification">
          <img src="../image/YH5TFCE1QY-preview.png" alt="profile" />
        </div>
      
      </div>
    </div>
   

    

    <div class="fixed bottom-0 w-full bg-zinc-900 py-2 px-4 flex justify-end items-center">
    </div>

    <!--This is the main content-->
    <div class="main-content">
      <html>
        <head>
          <meta charset="UTF-8">
          <meta name="viewport" content="width=device-width, initial-scale=1.0">
          <script src="https://cdn.tailwindcss.com"></script>
        </head>
        <div class=" ">
          <h1 class="text-3xl font-bold mt-[50px] ">HELLO, <span class="text-blue-600" id="uidFetchfullname"></span></h1>
          <h2 class="text-xl font-bold "  id="datetoday">_</h2>
          <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-3 gap-4 mt-10">


            <div class="bg-blue-300 p-10 rounded-lg shadow-lg border border-black hover:bg-blue-400 hover:shadow-xl transition duration-300 ease-in-out">
              <div class="flex items-center justify-between">
                <div class="text-8xl font-bold" id="usersCount"   ></div>
                <img aria-hidden="true" alt="user icon" class="w-200 h-200" src="../image/user.png"/>
              </div>
              <p class="text-2xl font-bold">STUDENTS</p>
              <a href="/studentsfaculty.html" class="text-white ">View</a>
            </div>


            <div class="bg-blue-300 p-10 rounded-lg shadow-lg border border-black hover:bg-blue-400 hover:shadow-xl transition duration-300 ease-in-out">
              <div class="flex items-center justify-between">
                <div class="text-8xl font-bold" id="facultyCount"   ></div>
                <img aria-hidden="true" alt="user icon" class="w-200 h-200" src="../image/faculty.png"/>
              </div>
              <p class="text-2xl font-bold">FACULTY</p>
              <a href="/teachersfaculty.html" class="text-white ">View</a>
            </div>

            
            <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
            <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script>
            <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
          <div class="bg-blue-300 p-4 rounded-lg shadow-lg border border-black w-300 h-280 row-span-2 hover:shadow-xl transition duration-300 ease-in-out" id="cardp">
  <div class="bg-white p-10 rounded-lg shadow w-600 h-280 row-span-2 pl-5" id="cardbooks">
    <div class="text-1xl font-bold text-center">Most Viewed Book</div>
    <div class="carousel relative overflow-hidden w-full h-full">
      <div id="carouselExample" class="carousel slide" data-ride="carousel">
        <div class="carousel-inner relative flex flex-nowrap w-full h-full">
          <div class="carousel-item active flex-shrink-0 w-full">
            <div class="book-title" id="booktitle1">Book Title 1</div>
            <div class="image-container">
              <img aria-hidden="true"  id="book1"  style="height: 350px; cursor: pointer;" />
            </div>
                      </div>
          <div class="carousel-item flex-shrink-0 w-full">
            <div class="book-title2" id="booktitle2">Book Title 1</div>
            <div class="image-container">
              <img aria-hidden="true" alt="book icon" id="book2"  style="height: 350px; cursor: pointer;" />
            </div>
          </div>
        </div>
        <!-- Add carousel controls -->
        <a class="carousel-control-prev"  href="#carouselExample" role="button" data-slide="prev" >
          <span  class="carousel-control-prev-icon" aria-hidden="true"  ></span> 
          <span class="sr-only" >Previous</span>
        </a>
        <a class="carousel-control-next" href="#carouselExample" role="button" data-slide="next">
          <span class="carousel-control-next-icon" aria-hidden="true"></span>
          <span class="sr-only">Next</span>
        </a>
      </div>
      
     
     
    </div>
  </div>
</div>
    






            <div class="bg-blue-300 p-10 rounded-lg shadow-lg border border-black hover:bg-blue-400 hover:shadow-xl transition duration-300 ease-in-out">
              <div class="flex items-center justify-between">
                <div class="text-8xl font-bold" id="booksCount"></div>
                <img aria-hidden="true" alt="faculty icon" class="w-200 h-200" src="../image/bookshelf.png"/>
              </div>
              <p class="text-2xl font-bold" id="booksDescription">BOOKS</p>
              <a href="/catalogfaculty.html" class="text-white ">View</a>
            </div>
            <div class="bg-blue-300 p-10 rounded-lg shadow-lg border border-black hover:bg-blue-400 hover:shadow-xl transition duration-300 ease-in-out">
              <div class="flex items-center justify-between">
                <div class="text-8xl font-bold" id="viewsCount"></div>
                <img aria-hidden="true" alt="faculty icon" class="w-200 h-200 " src="../image/visits.png"/>
              </div>
              <p class="text-2xl font-bold " >VISITS </p>
              <a href="#" class="text-white ">View</a>
            </div>
          </div>
    
          
          <!-- Long card added below -->
<div class="bg-blue-300 p-10 rounded-lg shadow-lg border-black w-full h-400 mt-10 hover:shadow-xl transition duration-300 ease-in-out">
  <h2 class="text-2xl font-bold w-full">NEWLY ADDED BOOKS </h2>
  <div class="flex overflow-x-auto">
    <!-- Card 1 -->
    <div class="bg-white p-4 rounded-lg shadow-md m-2" style="width: 300px;">
      <p class="text-gray-600 text-sm font-bold text-center" id="title"></p>
      <img id="imageBook" class="rounded-t-lg" style="width: 200px; height: 250px; object-fit: cover;">
    </div>
    <div class="bg-white p-4 rounded-lg shadow-md m-2" style="width: 300px;">
      <p class="text-gray-600 text-sm font-bold text-center" id="title2"></p>
      <img id="imageBook2" class="rounded-t-lg" style="width: 200px; height: 250px; object-fit: cover;">
    </div>
    <div class="bg-white p-4 rounded-lg shadow-md m-2" style="width: 300px;">
      <p class="text-gray-600 text-sm font-bold text-center" id="title3"></p>
      <img id="imageBook3" class="rounded-t-lg" style="width: 200px; height: 250px; object-fit: cover;">
    </div>
    <div class="bg-white p-4 rounded-lg shadow-md m-2" style="width: 300px;">
      <p class="text-gray-600 text-sm font-bold text-center" id="title4"></p>
      <img id="imageBook4" class="rounded-t-lg" style="width: 200px; height: 250px; object-fit: cover;">
    </div>

    <div class="bg-white p-4 rounded-lg shadow-md m-2" style="width: 300px;">
      <p class="text-gray-600 text-sm font-bold text-center" id="title5"></p>
      <img id="imageBook5" class="rounded-t-lg" style="width: 200px; height: 250px; object-fit: cover;">
    </div>

    <div class="bg-white p-4 rounded-lg shadow-md m-2" style="width: 300px;">
      <p class="text-gray-600 text-sm font-bold text-center" id="title6"></p>
      <img id="imageBook6" class="rounded-t-lg" style="width: 200px; height: 250px; object-fit: cover;">
    </div>

    
    <!-- Add more book cards here -->
  </div>
</div>
          </div>
        </div>
      </html>
     
      </div>
    
    </body>


<!-- Search-->
  




  <div id="logout"  style="display:none">

    <div class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50">
    <div class="bg-black dark:bg-zinc-800 rounded-lg shadow-lg w-11/12 sm:w-96 p-4">
        <div class="flex justify-between items-center border-b border-red-200 pb-2">
            <h2 class="text-red-600 dark:text-red-400 text-lg font-semibold">Log out</h2>
            <button class="text-zinc-600 dark:text-zinc-400 hover:text-zinc-800 dark:hover:text-zinc-200" id="changepassword"   >×</button>
        </div>
        <div class="flex items-center py-4">
            <img aria-hidden="true" alt="alert icon" src="../image/set-of-error-icon-information-logo-illustration-vector.png" height="80px" width="80px" class="rounded-full mr-4  " crossorigin="anonymous">
            <div>
                <h3 class="text-lg font-semibold text-red-600 dark:text-red-400">Are You Sure you want to logout?</h3>
                <p class="text-zinc-600 dark:text-zinc-300"></p>
            </div>
        </div>
        <div class="flex justify-end space-x-2 mt-4">
          <button  class="bg-dark dark:bg-zinc-700 text-zinc-800 dark:text-zinc-300  dark:border-zinc-600 rounded-lg py-2 px-4"  id="changepassword1"    >Cancel</button>
          <button class="bg-red-600 text-white rounded-lg py-2 px-4" id="confirm-logout">Log me out</button>
          </div>
    </div>
</div>
</div>

<!--sidebar Notification-->
<div class="fixed top-0 right-0 flex items-center justify-center bg-white notification-panel" id="notification-panel">
  <div class="bg-card rounded-lg shadow-lg p-6 w-80">
    <div class="flex justify-between items-center mb-4">
      <h2 class="text-lg font-semibold text-foreground">Notifications</h2>
      <button class="text-muted-foreground hover:text-muted close-button" id="close-button">×</button>
    </div>
    <div class="space-y-4">
      <div class="bg-white p-4 rounded-lg shadow-md">
        <h3 class="font-semibold">Text</h3>
        <p class="text-muted-foreground">Descriptions</p>
      </div>
      
    </div>
  </div>
</div>





<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">


<!-- Search-->

<!-- Firebase Function-->
 
<script src="https://cdn.firebase.com/libs/firebasejs/9.6.1/firebase-app.js" defer></script>
      <script src="https://cdn.firebase.com/libs/firebasejs/9.6.1/firebase-auth.js" defer></script>
      <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.1.1/firebase-app.js";
        import { getFirestore, collection, onSnapshot, getDocs, query, where,orderBy, limit,doc,getDoc } from "https://www.gstatic.com/firebasejs/9.1.1/firebase-firestore.js";
        import { getStorage, ref, getDownloadURL } from "https://www.gstatic.com/firebasejs/9.1.1/firebase-storage.js";
        import { getAuth,signOut, sendEmailVerification } from "https://www.gstatic.com/firebasejs/9.1.1/firebase-auth.js";
        import { signInWithEmailAndPassword,onAuthStateChanged} from "https://www.gstatic.com/firebasejs/9.1.1/firebase-auth.js";


const firebaseConfig = {
  apiKey: "AIzaSyCbWyVqhZdWL5tGF5Y2YXRpY5PJLC0ee6M",
  authDomain: "elibrarylogin-3d7e6.firebaseapp.com",
  projectId: "elibrarylogin-3d7e6",
  storageBucket: "elibrarylogin-3d7e6.appspot.com",
  messagingSenderId: "872832392728",
  appId: "1:872832392728:web:10489984713141407ded6d"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// Function to handle setting URL parameters and storing in sessionStorage
document.addEventListener('DOMContentLoaded', () => {
  function appendQueryParams(event) {
    event.preventDefault(); // Prevent default link behavior

    const uid = 'actualUID'; // Replace with actual UID value
    const url = new URL(event.target.href);

    url.searchParams.set('role', 'faculty');
    url.searchParams.set('uid', uid);

    // Store the UID and role in sessionStorage
    sessionStorage.setItem('uid', uid);
    sessionStorage.setItem('role', 'faculty');

    // Update the link's href with the new URL
    event.target.href = url.href;

    // Optionally, navigate to the new URL
    window.location.href = url.href;
  }

  // Check if we need to restore data from sessionStorage
  const urlParams = new URLSearchParams(window.location.search);
  let role = urlParams.get('role');
  let uid = urlParams.get('uid');

  if (role && uid) {
    sessionStorage.setItem('uid', uid);
    sessionStorage.setItem('role', role);
    console.log("Stored Role from URL:", role);
    console.log("Stored UID from URL:", uid);
  } else {
    uid = sessionStorage.getItem('uid');
    role = sessionStorage.getItem('role');
    console.log("Stored Role from sessionStorage:", role);
    console.log("Stored UID from sessionStorage:", uid);
  }

  // Add event listener to links for setting query parameters
  const link = document.querySelector('a#myLink'); // Replace with actual link selector
  if (link) {
    link.addEventListener('click', appendQueryParams);
  }

  // Function to get UID from URL or sessionStorage
  function getUIDFromURLorSession() {
    const urlParams = new URLSearchParams(window.location.search);
    let uid = urlParams.get('uid') || sessionStorage.getItem('uid');
    console.log("Extracted UID from URL or sessionStorage:", uid); // Debugging
    return uid;
  }

  // Fetch faculty full name from Firestore
  function fetchFacultyFullname(uid) {
    console.log("Fetching document for UID:", uid); // Debugging
    const facultyRef = doc(db, 'faculty', uid);

    getDoc(facultyRef).then((docSnap) => {
      if (docSnap.exists()) {
        console.log("Document data:", docSnap.data()); // Debugging
        const fullname = docSnap.data().fullname;
        document.getElementById("uidFetchfullname").textContent = fullname;
      } else {
        console.log("No such document!"); // Debugging
      }
    }).catch((error) => {
      console.log("Error getting document:", error); // Debugging
    });
  }

  // On page load, try to fetch the fullname using the UID
  const uidFromStorageOrURL = getUIDFromURLorSession();
  if (uidFromStorageOrURL) {
    fetchFacultyFullname(uidFromStorageOrURL);
  } else {
    console.log("UID not found in URL or sessionStorage"); // Debugging
  }
});

        //logoutbutton on dashboard
     // Select the logout button and the modal
const logoutButton = document.getElementById('logoutbutton'); // assume this is the ID of the logout button
const logoutModal = document.getElementById('logout');

// Add an event listener to the logout button
logoutButton.addEventListener('click', function() {
    // Toggle the display property of the modal
    logoutModal.style.display = 'block'; // show the modal
});

// Add an event listener to the cancel button
document.getElementById('changepassword').addEventListener('click', function() {
    // Toggle the display property of the modal
    logoutModal.style.display = 'none'; // hide the modal
});

document.getElementById('changepassword1').addEventListener('click', function() {
    // Toggle the display property of the modal
    logoutModal.style.display = 'none'; // hide the modal
});

document.getElementById('confirm-logout').addEventListener('click', function() {
    signOut(auth).then(() => {
        // Clear browser history to prevent back button navigation
        window.location.href = '/logoutloading.html'; // Redirect to login page
        history.pushState(null, null, window.location.href); 
        window.onpopstate = function () {
            history.go(1);
        };
    }).catch((error) => {
        console.error('Error signing out:', error);
        alert('Error signing out. Please try again.');
    });
});

const auth = getAuth();

onAuthStateChanged(auth, (user) => {
    if (!user) {
        // User is not signed in, redirect to login page
        window.location.href = '/index.html'; // Redirect to login page
    }
});
  //logoutbutton on pop up
  


//search function // // // // // // // //



window.onload = async function() {
    try {
        // Fetch and sort users
        const usersCollection = collection(db, 'users');
        const userSnapshot = await getDocs(usersCollection);
        const userDocs = userSnapshot.docs;

        const sortedUserDocs = userDocs.sort((a, b) => {
            const fullNameA = `${a.data().firstname} ${a.data().middlename} ${a.data().lastname}`;
            const fullNameB = `${b.data().firstname} ${b.data().middlename} ${b.data().lastname}`;
            return fullNameA.localeCompare(fullNameB);
        });

        // Fetch and sort books
        const booksCollection = collection(db, 'books');
        const bookSnapshot = await getDocs(booksCollection);
        const bookDocs = bookSnapshot.docs;

        const sortedBookDocs = bookDocs.sort((a, b) => {
            const titleA = a.data().title;
            const titleB = b.data().title;
            return titleA.localeCompare(titleB);
        });

        // Fetch and sort faculty members
        const facultyCollection = collection(db, 'faculty');
        const facultySnapshot = await getDocs(facultyCollection);
        const facultyDocs = facultySnapshot.docs;

        const sortedFacultyDocs = facultyDocs.sort((a, b) => {
            const emailA = a.data().email;
            const emailB = b.data().email;
            return emailA.localeCompare(emailB);
        });

        // Function to update the UI for users, books, and faculty members
        const updateUI = (searchTerm) => {
            const filteredUsers = sortedUserDocs.filter((doc) => {
                const fullName = `${doc.data().firstname} ${doc.data().middlename} ${doc.data().lastname}`;
                return fullName.toLowerCase().includes(searchTerm);
            });

            const filteredBooks = sortedBookDocs.filter((doc) => {
                const title = doc.data().title.toLowerCase();
                return title.includes(searchTerm);
            });

            const filteredFaculty = sortedFacultyDocs.filter((doc) => {
                const email = doc.data().email.toLowerCase();
                return email.includes(searchTerm);
            });

            // Update UI for users
            let hasUsers = false;
            for (let i = 1; i <= 3; i++) {
                const userNameElement = document.getElementById(`user${i}-name`);
                const userItemElement = userNameElement.parentElement; // Get the <li> element

                if (i <= filteredUsers.length) {
                    const data = filteredUsers[i - 1].data();
                    const fullName = `${data.firstname} ${data.middlename} ${data.lastname}`;
                    userNameElement.textContent = fullName;
                    userItemElement.style.display = ''; // Show the list item
                    hasUsers = true;
                } else {
                    userNameElement.textContent = '';
                    userItemElement.style.display = 'none'; // Hide the list item
                }
            }

            // Show or hide the Students section
            const studentsSection = document.getElementById('studentCollectiones');
            if (hasUsers) {
                studentsSection.style.display = ''; // Show the section if there are users
            } else {
                studentsSection.style.display = 'none'; // Hide the section if no users
            }

            // Update UI for books
            let hasBooks = false;
            for (let i = 1; i <= 3; i++) {
                const bookNameElement = document.getElementById(`book${i}-name`);
                const bookItemElement = bookNameElement.parentElement; // Get the <li> element

                if (i <= filteredBooks.length) {
                    const title = filteredBooks[i - 1].data().title;
                    bookNameElement.textContent = title;
                    bookItemElement.style.display = ''; // Show the list item
                    hasBooks = true;
                } else {
                    bookNameElement.textContent = '';
                    bookItemElement.style.display = 'none'; // Hide the list item
                }
            }

            // Show or hide the Books section
            const booksSection = document.getElementById('booksCollectiones');
            if (hasBooks) {
                booksSection.style.display = ''; // Show the section if there are books
            } else {
                booksSection.style.display = 'none'; // Hide the section if no books
            }

            // Update UI for faculty members
            let hasFaculty = false;
            for (let i = 1; i <= 3; i++) {
                const facultyNameElement = document.getElementById(`teachers${i}-name`);
                const facultyItemElement = facultyNameElement.parentElement; // Get the <li> element

                if (i <= filteredFaculty.length) {
                    const email = filteredFaculty[i - 1].data().email;
                    facultyNameElement.textContent = email;
                    facultyItemElement.style.display = ''; // Show the list item
                    hasFaculty = true;
                } else {
                    facultyNameElement.textContent = '';
                    facultyItemElement.style.display = 'none'; // Hide the list item
                }
            }

            // Show or hide the Faculty section
            const facultySection = document.getElementById('teachersCollectiones');
            if (hasFaculty) {
                facultySection.style.display = ''; // Show the section if there are faculty members
            } else {
                facultySection.style.display = 'none'; // Hide the section if no faculty members
            }
        };

        // Add event listener to the search input
        const searchInput = document.getElementById('search-input');
        searchInput.addEventListener('input', (e) => {
            const searchTerm = e.target.value.trim().toLowerCase();
            updateUI(searchTerm);
        });

        // Initial UI population with the first three users, books, and faculty members
        updateUI('');
    } catch (error) {
        console.error("Error fetching users, books, or faculty members: ", error);
    }
};













///////////////////////////////////////////////////////////////////////////////////////////////////////////////
//userscount
const usersRef = collection(db, 'users');


getDocs(usersRef).then((querySnapshot) => {
  let count = 0;
  querySnapshot.forEach((doc) => {
    count += 1; // increment count for each document
  });
  document.getElementById('usersCount').innerHTML = `${count}`;
});


//ViewCount
// ViewCount
const viewsRef = collection(db, 'bookingHistory');

getDocs(viewsRef).then((querySnapshot) => {
  let count = 0;
  querySnapshot.forEach((doc) => {
    count += 1; // increment count for each document
  });
  document.getElementById('viewsCount').innerHTML = `${count}`;
});
//facultycount
const facultyRef = collection(db, 'faculty');


getDocs(facultyRef).then((querySnapshot) => {
  let count = 0;
  querySnapshot.forEach((doc) => {
    count += 1; // increment count for each document
  });
  document.getElementById('facultyCount').innerHTML = `${count}`;
});

//bookscount

const booksRef = collection(db, 'books');

getDocs(booksRef).then((querySnapshot) => {
  let count = 0;
  querySnapshot.forEach((doc) => {
    count += 1; // increment count for each document
  });
  document.getElementById('booksCount').innerHTML = `${count}`;
});

// Get the last 5 books uploaded
getDocs(query(booksRef, orderBy('uploadedAt', 'desc'), limit(10))).then((querySnapshot) => {
  const books = querySnapshot.docs;
  const latestBook = books[0].data();
  const secondLatestBook = books[1].data();
  const thirdLatestBook = books[2].data();
  const fourthLatestBook = books[3].data();
  const fifthLatestBook = books[4].data();
  const sixthLatestBook = books[5].data();

  const latestBookImage = latestBook.img;
  const secondLatestBookImage = secondLatestBook.img;
  const thirdLatestBookImage = thirdLatestBook.img;
  const fourthLatestBookImage = fourthLatestBook.img;
  const fifthLatestBookImage = fifthLatestBook.img;
  const sixthLatestBookImage = sixthLatestBook.img;

  // Update the image src attributes
  document.getElementById('imageBook').src = latestBookImage;
  document.getElementById('imageBook2').src = secondLatestBookImage;
  document.getElementById('imageBook3').src = thirdLatestBookImage;
  document.getElementById('imageBook4').src = fourthLatestBookImage;
  document.getElementById('imageBook5').src = fifthLatestBookImage;
  document.getElementById('imageBook6').src = sixthLatestBookImage;


  // Update the title text
  document.getElementById('title').innerHTML = latestBook.title;
  document.getElementById('title2').innerHTML = secondLatestBook.title;
  document.getElementById('title3').innerHTML = thirdLatestBook.title;
  document.getElementById('title4').innerHTML = fourthLatestBook.title;
  document.getElementById('title5').innerHTML = fifthLatestBook.title;
  document.getElementById('title6').innerHTML = sixthLatestBook.title;

});


document.addEventListener('DOMContentLoaded', () => {
  // Get the current date
  const date = new Date();

  // Get the day, month, and year
  const day = date.getDate();
  const month = date.toLocaleString('default', { month: 'long' });
  const year = date.getFullYear();
  const dayOfWeek = date.toLocaleString('default', { weekday: 'long' });

  // Format the date string
  const dateString = `${month} ${day} ${year}, ${dayOfWeek}`;

  // Update the HTML element
  document.getElementById('datetoday').innerText = dateString;
});



//notification function 
const notificationBell = document.getElementById('notificationbell');
const notificationPanel = document.getElementById('notification-panel');
const closeButton = document.getElementById('close-button');

notificationBell.addEventListener('click', () => {
  notificationPanel.classList.add('show');
});

closeButton.addEventListener('click', () => {
  notificationPanel.classList.remove('show');
});



// Function to render suggestions


// Add event listener to the search input





  
async function getBookingHistory() {
  try {
    const querySnapshot = await getDocs(collection(db, 'bookingHistory'));

    // Group the data by bookId and count the number of occurrences
    const bookIdCounts = {};
    querySnapshot.forEach(doc => {
      const bookId = doc.data().bookId;
      if (bookIdCounts[bookId]) {
        bookIdCounts[bookId]++;
      } else {
        bookIdCounts[bookId] = 1;
      }
    });

    // Sort the grouped data in descending order
    const sortedBookIds = Object.keys(bookIdCounts).sort((a, b) => bookIdCounts[b] - bookIdCounts[a]);

    // Retrieve the top two bookIds
    const topTwoBookIds = sortedBookIds.slice(0, 2);

    // Retrieve the book data from the books collection
    const bookPromises = topTwoBookIds.map(bookId => {
      return getDoc(doc(db, 'books', bookId)); // Use getDoc and pass the specific document reference
    });

    // Wait for all the book data to be retrieved
    const books = await Promise.all(bookPromises);

    // Update the HTML with the book data
    books.forEach((book, index) => {
      const bookData = book.data();
      if (index === 0) {
        document.getElementById('booktitle1').innerText = bookData.title;
        document.getElementById('book1').src = bookData.img;
      } else if (index === 1) {
        document.getElementById('booktitle2').innerText = bookData.title;
        document.getElementById('book2').src = bookData.img;
      }
    });
  } catch (error) {
    console.error('Error:', error);
  }
}

getBookingHistory();



  </script>




</body>
</html>