<!DOCTYPE html>
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">
<html>
  <style>
  #img {
    position: relative; /* Ensure positioning context for absolute children */
    overflow: hidden;   /* Hide overflowed content */
  }

  #cover-preview {
    position: absolute; /* Position image within the container */
    top: 0;
    left: 0;
    width: 100%;        /* Make the image width fit the container */
    height: 100%;       /* Make the image height fit the container */
    object-fit: cover;  /* Maintain aspect ratio while covering the container */
    display: block;     /* Ensure image is visible */
  }

  #cover-text {
    position: absolute; /* Position text over the image if needed */
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    z-index: 1; /* Ensure text appears on top of the image */
  }
</style>

  <style>
    .top-bar {
       background-color: #01579B;
       color: #FFFFFF;
       padding: 5px;
       margin-top: auto;
       display: flex;
       justify-content: space-between;
       align-items: center;
       margin-left: auto;
       margin-right: auto;
   }

   .top-bar .title {
       font-size: 2rem;
       margin-left: 290px;
       font-weight: 600;
   }
   .top-bar .icons {
   display: flex;
   margin-top: 5px;
   margin-bottom: 5px;
   margin-right: 20px;
   align-items: center;
   gap: 2rem;
}


   .top-bar .icons img {
       width: 2rem;
       height: 2rem;
       border-radius: 50%;
       transition: background-color 0.3s ease-in-out, transform 0.3s ease-in-out;
       cursor: pointer;
   }

   .top-bar .icons img:hover {
       transform: scale(1.3);
   }



   .top-bar .icons .notification {
       position: relative;
   }

   .top-bar .icons .notification span {
       position: absolute;
       top: 0;
       right: 0;
       width: 1rem;
       height: 1rem;
       background-color: #0dff00;
       border-radius: 50%;
   }

   .sidebar {
 position: fixed;
 top: 0;
 bottom: 0;
 left: 0;
 width: 260px;
 background-color: #2C384A;
 color: #FFFFFF;
 padding: 1rem;
 display: flex;
 flex-direction: column;
 align-items: center;
 overflow-y: auto;
 scrollbar-width: thin; /* for Firefox */
 -ms-overflow-style: -ms-autohiding-scrollbar; /* for IE and Edge */
}

.sidebar .logo {
 font-size: 1.3rem;
 font-weight: 600;
 margin-bottom: 1rem;
}

.sidebar img {
 width: 170px;
 margin-bottom: 1rem;
}

.sidebar nav {
 flex-grow: 1;
 margin-top: 2rem;
}

.sidebar nav a {
 display: flex;
 align-items: center;
 padding: 0.3rem 0.3rem;
 color: #FFFFFF;
 text-decoration: none;
 transition: background-color 0.3s ease-in-out;
}

.sidebar nav a:hover {
 color: #79aefd;
}

.sidebar nav a img {
 width: 40px;
 height: 40px;
 margin-right: 1rem;
 margin-top: 20px;
}

.sidebar nav a span {
 font-size: 1rem;
 font-weight: 500;
}

   .main-content {
       margin-left: 260px;
       padding-left: 40px;
       padding-right: 20px;
       padding-bottom: 70px;
       margin-top: 1px;
   }

   .card {
       background-color: #FFFFFF;
       padding: 1rem;
       border: 1px solid #CCCCCC;
       border-radius: 10px;
       box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
   }

   .card h2 {
       margin-top: 0;
   }

   #chatheadsnotif {
   transition: transform 0.3s ease-in-out;
 }

 #chatheadsnotif:hover {
   transform: scale(1.2);
 }

 #chatheadsnotif.expanded {
   transform: scale(1.5);
 }

 #chatheadsnotif.expanded #chatheads {
   width: 80px;
   height: 80px;
 }

 #chatheadsnotif.expanded .absolute {
   bottom: -10px;
   right: -10px;
 }
 .upload-button {
 position: relative;
 overflow: hidden;
 display: inline-block;
}



.upload-button  {
 background-color: #01579B;
 color: #fff;
 padding: 5px 10px; 
 border-radius: 20px;
 margin-top: 10px;
 margin-bottom: 10px;

 border: none;
 border-radius: 5px;
 ;
}

.upload-button:hover {
 background-color: #559af5;
 ;
}

.upload-button:active {
 background-color: #539cf0;
 box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
 ;

}

th.border{
 background-color: #01579B;
 color:white;
 text-align: center;
}
 </style>
 
<style>
 #book-icon {
 transition: transform 0.5s; /* add transition effect */
}

#book-icon:hover {
 transform: scale(1.1); /* scale up by 10% on hover */
}


body {
 overflow: -moz-scrollbars-none;
 -ms-overflow-style: none;
}

:root {
 scrollbar-width: none !important;
}
.search-bar {
 width: 300px;
 position: absolute;
 top: 50; /* changed to 0 to make it on top */
 left: 50%;
 transform: translateX(-50%);
 z-index: 3; /* added to make it on top of everything */
}

#search-input {
 flex: 2;
 width: 400px;
 padding: 10px;
 color: black;
 font-size: 12px;
 border: none;
 border-radius: 10px 10px 10px 10px;
}



.suggestions {
 position: absolute;
 top: 35px;
 background-color: #f9f9f9;
 border: 1px solid #ccc;
 padding: 10px;
 width: 400px;
 display: none;
 color: black;
 z-index: 3; /* added to make it on top of everything */
 overflow-y: auto; /* add this */
 max-height: 350px; /* or a fixed height */
}
.like-dislike-bar {
  display: flex;
  width: 100%;
  height: 10px;
  background-color: #e0e0e0; /* Light gray background */
  border-radius: 5px;
}

.like-bar {
  background-color: green;
  height: 100%;
  border-radius: 5px 0 0 5px;
}

.dislike-bar {
  background-color: red;
  height: 100%;
  border-radius: 0 5px 5px 0;
}
#dropdown {
    background-color: #01579B;
    border: 1px solid #ccc;
    width: 200px;
    padding: 10px;
    position: fixed;  /* Keeps it fixed on the screen */
    top: 100px;  /* Adjust this as needed */
    left: 665px;  /* Adjust this as needed */
    z-index: 2147483647;  /* Max value for z-index, ensures it's the topmost */
    display: none;  /* Initially hidden */
}

#dropdown ul {
    list-style-type: none;
    padding: 0;
}

#dropdown li {
    padding: 8px;
    cursor: pointer;
}

#dropdown li:hover {
    background-color: #ddd;
}




td {
  text-align: center;
  border-width: 50px; /* Increased border thickness */
  border-style: solid;
  border-color: #ccc; /* Light gray border color */
}
.suggestions ul {
list-style: none;
 padding: 0;
 margin: 0;
}

.suggestions li {
 padding: 10px;
 border-bottom: 1px solid #ccc;
 display: flex;
 align-items: center;
}

.suggestion-photo {
 width: 30px;
 height: 30px;
 margin-right: 10px;
 border-radius: 50%;
}

.suggestions li:hover {
 background-color: #d1cfcf;
 cursor: pointer;
}

#search-input:focus + .suggestions {
 display: block;
}



.show {
 display: block; /* show the search bar wh en the show    is added */
}






.sidebar nav a1 {
       display: flex;
       align-items: center;
       padding: 0.3rem 0.3rem;
       color: #79aefd;
       text-decoration: none;
       transition: background-color 0.3s ease-in-out;
   }
  
   

   
   .sidebar nav a1:hover{
     color: #79aefd;
   }

   .sidebar nav a1 img {
       width: 40px;
       height: 40px;
       margin-right: 1rem;
       margin-top: 20px;
   }
  
   .sidebar nav a1 span {
       font-size: 1rem;
       font-weight: 500;
   }


   select {
 width: 200px; /* adjust the width as needed */
 padding: 10px;
 border: 1px solid #232121;
 border-radius: 5px;
 margin-top: 35px;
 font-size: 16px;
 margin-bottom: 20px;
}


.notification-panel {
 transform: translateX(100%);
 transition: transform 0.3s ease-in-out;
}

.notification-panel.show {
 transform: translateX(0);
}

.close-button {
 cursor: pointer;
}


.edit-button{
 width: 10%;
}
.delete-button{
 width: 10% ; 
}



</style>

<head>
    
  </head>
  
  <div class="sidebar">
    <div class="logo">STI VIGAN E-LIBRARY</div>
    <img src="../image/sti logo 4 (2).png" alt="STI Logo" />
    <nav>
      <a  href="/dashboard2.html">
          <img src="../image/home.png" alt="Others Icon" />
          <span>Dashboard</span>
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M19 9l-7 7-7-7"/>
          </svg>
      </a>
      <a href="/catalog.html">
          <img src="../image/catalog.png" alt="Others Icon" />
          <span>Catalogs</span>
         
      </a>
      <a href="/archive.html">
        <img src="../image/catalog.png" alt="Others Icon" />
        <span>Archive </span>
       
    </a>
      <a href="/StudentsUploading.html">
        <img src="../image/user (1).png" alt="Others Icon" />
        <span>Students</span>
       
    </a>
    
     
      
      <a href="#" id="logoutbutton">
        <img src="../image/logout.png"  />
        <span>Log-out</span>

      
    </a>
  </nav>
</div>

  <body>
    <div class="top-bar">
      <div class="title">Archived Authors</div>
      <div class="search-bar">
        <input id="search-input" type="text" placeholder="Search..." autocomplete="off" >
        <div class="suggestions">
          <ul>
            <!--BOOKS-->
            <p id="booksCollectiones"><b>Books</b></p>
            <li>
              <img id="books1" src="../image/icons8-books-48.png" alt="photo" class="suggestion-photo">
              <span id="book1-name"></span>
            </li>          
            <li>
              <img id="books2" src="../image/icons8-books-48.png" alt="photo" class="suggestion-photo">
              <span id="book2-name"></span>
            </li>   
            <li>
              <img id="books3" src="../image/icons8-books-48.png" alt="photo" class="suggestion-photo">
              <span id="book3-name"></span>
            </li>   
            <!--sTUDENTS-->
            <p id="studentCollectiones"><b>Students</b></p>
            <li>
              <img id="users1" src="../image/student.png" alt="photo" class="suggestion-photo">
              <span id="user1-name"></span>
            </li>   
            <li>
              <img id="users2" src="../image/student.png" alt="photo" class="suggestion-photo">
              <span id="user2-name"></span>
            </li>   
            <li>
              <img id="users3" src="../image/student.png" alt="photo" class="suggestion-photo">
              <span id="user3-name"></span>
            </li>
            <!--teachers-->
            <p id="teachersCollectiones"><b>Faculty</b></p>
            <li>
              <img id="teachers1" src="../image/teacher.png" alt="photo" class="suggestion-photo">
              <span id="teachers1-name"></span>
            </li>   
            <li>
              <img id="teachers2" src="../image/teacher.png" alt="photo" class="suggestion-photo">
              <span id="teachers2-name"></span>
            </li>   
            <li>
              <img id="teachers3" src="../image/teacher.png" alt="photo" class="suggestion-photo">
              <span id="teachers3-name"></span>
            </li>
          </ul>
        </div>
      </div>




      <div class="icons">
       
        
        
        <div class="notification" >
        </div>
      
      </div>
    </div>
   
    </div>
   
   

    

    <div class="fixed bottom-0 w-full bg-zinc-900 py-2 px-4 flex justify-end items-center">
    </div>

    <!--This is the main content-->
    <div class="main-content">
      <html>
        <head>
          <meta charset="UTF-8">
          <meta name="viewport" content="width=device-width, initial-scale=1.0">
          <meta name="viewport" content="width=device-width, initial-scale=1.0">
          <script src="https://cdn.tailwindcss.com"></script>
        </head>
      
     




        <!--main content here-->


        
        
      <div class="upload-button">
        <a href="archive.html">
          <label id="AuthorsPage" for="file-input">Back to Archived Books</label>
        </a>
      </div>
      
  
      
      <div  id="AuthorsPage" class="upload-button">
        <a href="ArchiveStudent.html">
          <label id="AuthorsPage" for="file-input">Archived Students</label>
        </a>
      </div>
      
      
      

       
             
    
<!-- Books Retrieval-->
<div class="overflow-x-auto">
  <table class="min-w-full border-collapse border border-zinc-200">
    <thead>
      <tr>
        <th id="th" class="border border-zinc-300 bg-zinc-100 px-4 py-2">Authors</th>
        <th class="border border-zinc-300 bg-zinc-100 px-4 py-2">No. of Books</th>




       
        </th>

      </tr>
    </thead>
    <tbody id="books-table-body">
      <!-- data will be rendered here -->
    </tbody>
  </table>
</div>
<!--sidebar Notification-->
<div class="fixed top-0 right-0 flex items-center justify-center bg-white notification-panel" id="notification-panel">
  <div class="bg-card rounded-lg shadow-lg p-6 w-80">
    <div class="flex justify-between items-center mb-4">
      <h2 class="text-lg font-semibold text-foreground">Notifications</h2>
      <button class="text-muted-foreground hover:text-muted close-button" id="close-button">×</button>
    </div>
    <div class="space-y-4">
      <div class="bg-white p-4 rounded-lg shadow-md">
        <h3 class="font-semibold">Text</h3>
        <p class="text-muted-foreground">Descriptions</p>
      </div>
      
    </div>
  </div>
</div>



        <!--up to here-->
    </body>







<!-- Search-->
  


<!--Logout pop up-->

  <div id="logout"  style="display:none">

    <div class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50">
    <div class="bg-white dark:bg-zinc-800 rounded-lg shadow-lg w-11/12 sm:w-96 p-4">
        <div class="flex justify-between items-center border-b border-red-200 pb-2">
            <h2 class="text-red-600 dark:text-red-400 text-lg font-semibold">Log out</h2>
            <button class="text-zinc-600 dark:text-zinc-400 hover:text-zinc-800 dark:hover:text-zinc-200" id="changepassword"   >×</button>
        </div>
        <div class="flex items-center py-4">
            <img aria-hidden="true" alt="alert icon" src="../image/set-of-error-icon-information-logo-illustration-vector.png" height="80px" width="80px" class="rounded-full mr-4  " crossorigin="anonymous">
            <div>
                <h3 class="text-lg font-semibold text-red-600 dark:text-red-400">Are You Sure you want to logout?</h3>
                <p class="text-zinc-600 dark:text-zinc-300"></p>
            </div>
        </div>
        <div class="flex justify-end space-x-2 mt-4">
          <button  class="bg-white dark:bg-zinc-700 text-zinc-800 dark:text-zinc-300 border border-zinc-300 dark:border-zinc-600 rounded-lg py-2 px-4"  id="changepassword1"    >Cancel</button>
          <button class="bg-red-600 text-white rounded-lg py-2 px-4" id="confirm-logout" >Log me out</button>
          </div>
    </div>
</div>z`
</div>


<!--Popup-->
<div class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 overflow-y-auto z-50" id="addbooks" style="display:none;">
  <div class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50">
    <div class="bg-white dark:bg-card rounded-lg p-5 shadow-lg w-96">
      <div class="flex justify-between items-center mb-4">
        <h2 class="text-lg font-semibold"  >ADD</h2>
        <button class="text-xl" id="closeaddbooks3">&times;</button>
      </div>
      <div class="overflow-y-auto h-96"> <!-- Add this wrapper element -->
        <form>
        <div class="mb-4">
          <label class="block text-sm font-medium text-zinc-700 black:text-zinc-300">TITLE</label>
          <input  id="title"   type="text" class="mt-1 block w-full border border-zinc-300 rounded-md shadow-sm focus:ring-primary focus:border-primary" />
        </div>
        <div class="mb-4">
          <label class="block text-sm font-medium text-zinc-700 black:text-zinc-300">MEDIA TYPE</label>
          <select  id="mediaType"  class="mt-1 block w-full border border-zinc-300 rounded-md shadow-sm focus:ring-primary focus:border-primary">
            <option value="">Select Media Type</option>
            
            <option id="audioVisuals"> Audio / Visuals</option>
            <option id="books"> Books</option>
            <option id="textebooks"> E-Books</option>
            <option id="ejournals"> E-Journals</option>
            <option id="books"> Journals</option>
            <option id="magazine"> Magazine</option>

            <option id="books"> Presentation</option>

            <option id="books"> Research</option>




            
          </select>
        </div>
        <div class="mb-4">
          <label class="block text-sm font-medium text-zinc-700 black:text-zinc-300">AUTHORS</label>
          <input id="authors" type="text" class="mt-1 block w-full border border-zinc-300 rounded-md shadow-sm focus:ring-primary focus:border-primary" />
        </div>
        <div class="mb-4">
          <label class="block text-sm font-medium text-zinc-700 black:text-zinc-300">ISBN</label>
          <input id="isbn"  type="text" class="mt-1 block w-full border border-zinc-300 rounded-md shadow-sm focus:ring-primary focus:border-primary" />
        </div>
        <div class="mb-4">
          <label class="block text-sm font-medium text-zinc-700 black:text-zinc-300">PUBLISHER</label>
          <input id="publisher" type="text" class="mt-1 block w-full border border-zinc-300 rounded-md shadow-sm focus:ring-primary focus:border-primary" />
        </div>
        <div class="mb-4">
          <label class="block text-sm font-medium text-zinc-700 black:text-zinc-300">SUBJECT</label>
          <input id="subject" type="text" class="mt-1 block w-full border border-zinc-300 rounded-md shadow-sm focus:ring-primary focus:border-primary" />
        </div>
        <div class="mb-4">
          <label  class="block text-sm font-medium text-zinc-700 black:text-zinc-300">STRAND/COURSE</label>
          <input id="strandsCourses"     type="text" class="mt-1 block w-full border border-zinc-300 rounded-md shadow-sm focus:ring-primary focus:border-primary" />
        </div>
        <div class="mb-4">
          <label class="block text-sm font-medium text-zinc-700 black:text-zinc-300">CATEGORY</label>
          <input id="category"     type="text" class="mt-1 block w-full border border-zinc-300 rounded-md shadow-sm focus:ring-primary focus:border-primary" />

        </div>
        <div class="mb-4">
          <label class="block text-sm font-medium text-zinc-700 black:text-zinc-300">FULL DESCRIPTION</label>
          <textarea  id="fulldescription" class="mt-1 block w-full border border-zinc-300 rounded-md shadow-sm focus:ring-primary focus:border-primary"></textarea>
        </div>
        
        <div class="mb-4">
          <label class="block text-sm font-medium text-zinc-700 black:text-zinc-300">YEAR</label>
          <input id="year"  type="text" class="mt-1 block w-full border border-zinc-300 rounded-md shadow-sm focus:ring-primary focus:border-primary" />
        </div>
        
        <div class="mb-4">
          <label class="block text-sm font-medium text-zinc-700 black:text-zinc-300">VOLUME</label>
          <input id="volume"  type="text" class="mt-1 block w-full border border-zinc-300 rounded-md shadow-sm focus:ring-primary focus:border-primary" />
        </div>
        <div class="mb-4">
          <label class="block text-sm font-medium text-zinc-700 black:text-zinc-300">PAGE</label>
          <input  id="pages" type="text" class="mt-1 block w-full border border-zinc-300 rounded-md shadow-sm focus:ring-primary focus:border-primary" />
        </div>
        <div class="mb-4">
          <label class="block text-sm font-medium text-zinc-700 black :text-zinc-300">Add Book Cover</label>
          <div id="img" class="border-dashed border-2 border-zinc-300 rounded-md h-40 flex items-center justify-center text-zinc-500">
            <span id="cover-text">Add Book Cover</span>
            <img id="cover-preview" src="" alt="Book Cover" class="hidden w-full h-full object-contain">
          </div>
          <input id="coverInput" type="file" accept="image/*" class="hidden" />
          <input id="pdfLink" type="file" class="custom-file-input mt-2" />
        </div>
        

        </div>
        <div class="flex justify-between">
          <button  class="bg-primary text-primary-foreground hover:bg-primary/80 px-4 py-2 rounded-md"  id="closeaddbooks1">ADD</button>
        </div>
      </form>
    </div>
  </div>
</div>











<div id="updateAuthor" style="display: none;">
  <div class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50">
    <div class="bg-white dark:bg-zinc-800 rounded-lg shadow-lg w-[720px] h-[480px] max-h-[90vh] overflow-y-auto p-4">
      <div class="flex justify-between items-center border-b border-blue-200 pb-2">
        <h2 class="text-blue-600 dark:text-blue-400 text-lg font-semibold">Update Author</h2>
      </div>
      <div class="flex items-center py-4">
        <img aria-hidden="true" alt="alert icon" src="/image/pen.png" height="80px" width="50px" class="rounded-full mr-4" crossorigin="anonymous">
        <div>
          <h3 class="text-lg font-semibold text-blue-600 dark:text-blue-400" id="clickedRowtoShowonEdit">Edit</h3>
          <p class="text-zinc-600 dark:text-zinc-300"></p>
        </div>
      </div>
      <div class="py-2">
        <!-- Author Name -->
        <label for="authorNameInput" class="block text-blue-600 dark:text-blue-400 font-semibold">Author Name</label>
        <input type="text" id="authorNameInput" class="w-full p-2 mt-1 border border-blue-300 rounded-lg dark:bg-zinc-700 dark:text-white" placeholder="Enter author name">

        
        <!-- Author Books -->
        <label for="authorBooks" class="block text-blue-600 dark:text-blue-400 font-semibold mt-4">Books by Author</label>
        <div class="overflow-x-auto">
          <table class="w-full border-collapse border border-zinc-300 text-sm">
            <thead>
              <tr class="bg-blue-200 dark:bg-blue-400">
                <th class="border border-zinc-300 px-4 py-2">Category</th>
                <th class="border border-zinc-300 px-4 py-2">ID</th>
                <th class="border border-zinc-300 px-4 py-2">Title</th>
                <th class="border border-zinc-300 px-4 py-2">Authors</th>
                <th class="border border-zinc-300 px-4 py-2">Publisher</th>
                
                <th class="border border-zinc-300 px-4 py-2">Date Added</th>
              </tr>
            </thead>
            <tbody id="booksTableBody"></tbody>
          </table>
        </div>
      </div>
      <div class="flex justify-end space-x-2 mt-4">
        <button class="bg-red-600 dark:text-zinc-300 border rounded-lg py-2 px-4 text-white" id="yeseditInfodelete">Delete</button>

        <button class="bg-red-600 dark:text-zinc-300 border rounded-lg py-2 px-4 text-white" id="yeseditInfocancel">Cancel</button>

        <button class="bg-blue-600 dark:text-zinc-300 border rounded-lg py-2 px-4 text-white" id="archiveAuthor">Retrieve</button>

        <button class="bg-blue-600 text-white rounded-lg py-2 px-4" id="confirmAuth">Confirm</button>
      </div>
    </div>
  </div>
</div>







<!-- Search-->








<!-- Firebase Function-->
 
<script src="https://cdn.firebase.com/libs/firebasejs/9.6.1/firebase-app.js" defer></script>
      <script src="https://cdn.firebase.com/libs/firebasejs/9.6.1/firebase-auth.js" defer></script>

      
      <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/9.1.1/firebase-app.js";
import { getFirestore, getDocs, query, where,doc,setDoc,deleteDoc,getDoc,updateDoc,writeBatch,addDoc} from "https://www.gstatic.com/firebasejs/9.1.1/firebase-firestore.js";
import{collection,onSnapshot}from "https://www.gstatic.com/firebasejs/9.1.1/firebase-firestore.js";
import {   getStorage, 
  ref, 
  uploadBytes, 
  getDownloadURL } from "https://www.gstatic.com/firebasejs/9.1.1/firebase-storage.js";
import { getAuth, sendEmailVerification } from "https://www.gstatic.com/firebasejs/9.1.1/firebase-auth.js";
import { signInWithEmailAndPassword ,onAuthStateChanged,signOut} from "https://www.gstatic.com/firebasejs/9.1.1/firebase-auth.js";

      
        const firebaseConfig = {
          apiKey: "AIzaSyCbWyVqhZdWL5tGF5Y2YXRpY5PJLC0ee6M",
  authDomain: "elibrarylogin-3d7e6.firebaseapp.com",
  projectId: "elibrarylogin-3d7e6",
  storageBucket: "elibrarylogin-3d7e6.appspot.com",
  messagingSenderId: "872832392728",
  appId: "1:872832392728:web:10489984713141407ded6d"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const storage = getStorage(app); // Storage instance


        //logoutbutton on dashboard
     // Select the logout button and the modal
const logoutButton = document.getElementById('logoutbutton'); // assume this is the ID of the logout button
const logoutModal = document.getElementById('logout');

// Add an event listener to the logout button
logoutButton.addEventListener('click', function() {
    // Toggle the display property of the modal
    logoutModal.style.display = 'block'; // show the modal
});

// Add an event listener to the cancel button
document.getElementById('changepassword').addEventListener('click', function() {
    // Toggle the display property of the modal
    logoutModal.style.display = 'none'; // hide the modal
});

document.getElementById('changepassword1').addEventListener('click', function() {
    // Toggle the display property of the modal
    logoutModal.style.display = 'none'; // hide the modal
});

document.getElementById('confirm-logout').addEventListener('click', function() {
    signOut(auth).then(() => {
        // Clear browser history to prevent back button navigation
        window.location.href = '/logoutloading.html'; // Redirect to login page
        history.pushState(null, null, window.location.href); 
        window.onpopstate = function () {
            history.go(1);
        };
    }).catch((error) => {
        console.error('Error signing out:', error);
        alert('Error signing out. Please try again.');
    });
});

const auth = getAuth();

onAuthStateChanged(auth, (user) => {
    if (!user) {
        // User is not signed in, redirect to login page
        window.location.href = '/index.html'; // Redirect to login page
    }
});
  //logoutbutton on pop up
  
const updateUI = (searchTerm) => {
    const filteredUsers = sortedUserDocs.filter((doc) => {
        const fullName = `${doc.data().firstname} ${doc.data().middlename} ${doc.data().lastname}`;
        return fullName.toLowerCase().includes(searchTerm);
    });

    const filteredBooks = sortedBookDocs.filter((doc) => {
        const title = doc.data().title.toLowerCase();
        return title.includes(searchTerm);
    });

    const filteredFaculty = sortedFacultyDocs.filter((doc) => {
        const email = doc.data().email.toLowerCase();
        return email.includes(searchTerm);
    });

    // Update UI for users
    let hasUsers = false;
    for (let i = 1; i <= 3; i++) {
        const userNameElement = document.getElementById(`user${i}-name`);
        const userItemElement = userNameElement.parentElement; // Get the <li> element

        if (i <= filteredUsers.length) {
            const data = filteredUsers[i - 1].data();
            const fullName = `${data.firstname} ${data.middlename} ${data.lastname}`;
            userNameElement.textContent = fullName;
            userItemElement.style.display = ''; // Show the list item
            hasUsers = true;
        } else {
            userNameElement.textContent = '';
            userItemElement.style.display = 'none'; // Hide the list item
        }
    }

    // Show or hide the Students section
    const studentsSection = document.getElementById('studentCollectiones');
    if (hasUsers) {
        studentsSection.style.display = ''; // Show the section if there are users
    } else {
        studentsSection.style.display = 'none'; // Hide the section if no users
    }

    // Update UI for books
    let hasBooks = false;
    for (let i = 1; i <= 3; i++) {
        const bookNameElement = document.getElementById(`book${i}-name`);
        const bookItemElement = bookNameElement.parentElement; // Get the <li> element

        if (i <= filteredBooks.length) {
            const title = filteredBooks[i - 1].data().title;
            bookNameElement.textContent = title;
            bookItemElement.style.display = ''; // Show the list item
            hasBooks = true;
        } else {
            bookNameElement.textContent = '';
            bookItemElement.style.display = 'none'; // Hide the list item
        }
    }

    // Show or hide the Books section
    const booksSection = document.getElementById('booksCollectiones');
    if (hasBooks) {
        booksSection.style.display = ''; // Show the section if there are books
    } else {
        booksSection.style.display = 'none'; // Hide the section if no books
    }

    // Update UI for faculty members
    let hasFaculty = false;
    for (let i = 1; i <= 3; i++) {
        const facultyNameElement = document.getElementById(`teachers${i}-name`);
        const facultyItemElement = facultyNameElement.parentElement; // Get the <li> element

        if (i <= filteredFaculty.length) {
            const email = filteredFaculty[i - 1].data().email;
            facultyNameElement.textContent = email;
            facultyItemElement.style.display = ''; // Show the list item
            hasFaculty = true;
        } else {
            facultyNameElement.textContent = '';
            facultyItemElement.style.display = 'none'; // Hide the list item
        }
    }

    // Show or hide the Faculty section
    const facultySection = document.getElementById('teachersCollectiones');
    if (hasFaculty) {
        facultySection.style.display = ''; // Show the section if there are faculty members
    } else {
        facultySection.style.display = 'none'; // Hide the section if no faculty members
    }

    // Add search for row text content
    const rows = document.querySelectorAll("tr");
    rows.forEach((row) => {
        const rowTextContent = row.textContent.toLowerCase();
        if (rowTextContent.includes(searchTerm)) {
            row.style.display = ''; // Show row if search term matches
        } else {
            row.style.display = 'none'; // Hide row if no match
        }
    });
};



//search function // // // // // // // //


window.onload = async function() {
    try {
        // Fetch and sort users
        const usersCollection = collection(db, 'users');
        const userSnapshot = await getDocs(usersCollection);
        const userDocs = userSnapshot.docs;

        const sortedUserDocs = userDocs.sort((a, b) => {
            const fullNameA = `${a.data().firstname} ${a.data().middlename} ${a.data().lastname}`;
            const fullNameB = `${b.data().firstname} ${b.data().middlename} ${b.data().lastname}`;
            return fullNameA.localeCompare(fullNameB);
        });

        // Fetch and sort books
        const booksCollection = collection(db, 'books');
        const bookSnapshot = await getDocs(booksCollection);
        const bookDocs = bookSnapshot.docs;

        const sortedBookDocs = bookDocs.sort((a, b) => {
            const titleA = a.data().title;
            const titleB = b.data().title;
            return titleA.localeCompare(titleB);
        });

        // Fetch and sort faculty members
        const facultyCollection = collection(db, 'faculty');
        const facultySnapshot = await getDocs(facultyCollection);
        const facultyDocs = facultySnapshot.docs;

        const sortedFacultyDocs = facultyDocs.sort((a, b) => {
            const emailA = a.data().email;
            const emailB = b.data().email;
            return emailA.localeCompare(emailB);
        });

        // Function to update the UI for users, books, and faculty members
        const updateUI = (searchTerm) => {
            const filteredUsers = sortedUserDocs.filter((doc) => {
                const fullName = `${doc.data().firstname} ${doc.data().middlename} ${doc.data().lastname}`;
                return fullName.toLowerCase().includes(searchTerm);
            });

            const filteredBooks = sortedBookDocs.filter((doc) => {
                const title = doc.data().title.toLowerCase();
                return title.includes(searchTerm);
            });

            const filteredFaculty = sortedFacultyDocs.filter((doc) => {
                const email = doc.data().email.toLowerCase();
                return email.includes(searchTerm);
            });

            // Update UI for users
            let hasUsers = false;
            for (let i = 1; i <= 3; i++) {
                const userNameElement = document.getElementById(`user${i}-name`);
                const userItemElement = userNameElement.parentElement; // Get the <li> element

                if (i <= filteredUsers.length) {
                    const data = filteredUsers[i - 1].data();
                    const fullName = `${data.firstname} ${data.middlename} ${data.lastname}`;
                    userNameElement.textContent = fullName;
                    userItemElement.style.display = ''; // Show the list item
                    hasUsers = true;
                } else {
                    userNameElement.textContent = '';
                    userItemElement.style.display = 'none'; // Hide the list item
                }
            }

            // Show or hide the Students section
            const studentsSection = document.getElementById('studentCollectiones');
            if (hasUsers) {
                studentsSection.style.display = ''; // Show the section if there are users
            } else {
                studentsSection.style.display = 'none'; // Hide the section if no users
            }

            // Update UI for books
            let hasBooks = false;
            for (let i = 1; i <= 3; i++) {
                const bookNameElement = document.getElementById(`book${i}-name`);
                const bookItemElement = bookNameElement.parentElement; // Get the <li> element

                if (i <= filteredBooks.length) {
                    const title = filteredBooks[i - 1].data().title;
                    bookNameElement.textContent = title;
                    bookItemElement.style.display = ''; // Show the list item
                    hasBooks = true;
                } else {
                    bookNameElement.textContent = '';
                    bookItemElement.style.display = 'none'; // Hide the list item
                }
            }

            // Show or hide the Books section
            const booksSection = document.getElementById('booksCollectiones');
            if (hasBooks) {
                booksSection.style.display = ''; // Show the section if there are books
            } else {
                booksSection.style.display = 'none'; // Hide the section if no books
            }

            // Update UI for faculty members
            let hasFaculty = false;
            for (let i = 1; i <= 3; i++) {
                const facultyNameElement = document.getElementById(`teachers${i}-name`);
                const facultyItemElement = facultyNameElement.parentElement; // Get the <li> element

                if (i <= filteredFaculty.length) {
                    const email = filteredFaculty[i - 1].data().email;
                    facultyNameElement.textContent = email;
                    facultyItemElement.style.display = ''; // Show the list item
                    hasFaculty = true;
                } else {
                    facultyNameElement.textContent = '';
                    facultyItemElement.style.display = 'none'; // Hide the list item
                }
            }

            // Show or hide the Faculty section
            const facultySection = document.getElementById('teachersCollectiones');
            if (hasFaculty) {
                facultySection.style.display = ''; // Show the section if there are faculty members
            } else {
                facultySection.style.display = 'none'; // Hide the section if no faculty members
            }
        };

        // Add event listener to the search input
        const searchInput = document.getElementById('search-input');
        searchInput.addEventListener('input', (e) => {
            const searchTerm = e.target.value.trim().toLowerCase();
            updateUI(searchTerm);
        });

        // Initial UI population with the first three users, books, and faculty members
        updateUI('');
    } catch (error) {
        console.error("Error fetching users, books, or faculty members: ", error);
    }
};























////////////////////////////////////////////////////////////////BOOKS....................///////////////////////////////////

//addbooks function pop up

var closeButton = document.getElementById("closeaddbooks");


var closeButton1 = document.getElementById("closeaddbooks1");

closeButton1.addEventListener("click", function() {
  addbooks.style.display = "none";
});

//notification function 
const notificationBell = document.getElementById('notificationbell');
const notificationPanel = document.getElementById('notification-panel');
const closerButton = document.getElementById('close-button');




/////////////////AUTHORS BOOKS










  let selectedBookId = null; // To store the ID of the selected book
  const booksCollection = collection(db, "archive");
  const authorsCollection = collection(db, "archiveAuthors");

  onSnapshot(booksCollection, (booksSnapshot) => {
    const tableBody = document.getElementById("books-table-body");
    tableBody.innerHTML = ""; // Clear the table before adding new rows

    // Group books by author (fieldname = authors in books collection)
    const groupedBooks = booksSnapshot.docs.reduce((acc, bookDoc) => {
      const bookData = bookDoc.data();
      const authorName = bookData.authors; // Fieldname in books collection
      if (!acc[authorName]) {
        acc[authorName] = 0;
      }
      acc[authorName] += 1; // Increment count for the author
      return acc;
    }, {});

    // Fetch all authors from the authors collection
    onSnapshot(authorsCollection, (authorsSnapshot) => {
      const authors = authorsSnapshot.docs.map((doc) => doc.data());
      const existingAuthors = Object.keys(groupedBooks); // Authors with books

      authors.forEach((author) => {
        const authName = author.authName; // Fieldname in authors collection
        const bookCount = groupedBooks[authName] || 0; // Get count of books, default 0 if none

        const row = document.createElement("tr");
        row.classList.add("hover:bg-zinc-50", "cursor-pointer");

        row.innerHTML = `
          <td class="border border-zinc-300 px-4 py-2">${authName}</td>
          <td class="border border-zinc-300 px-4 py-2">${bookCount}</td>
        `;
        tableBody.appendChild(row);
      });

      // Add rows for authors present in the books collection but not in the authors collection
      existingAuthors.forEach((authorName) => {
        if (!authors.some((author) => author.authName === authorName)) {
          const row = document.createElement("tr");
          row.classList.add("hover:bg-zinc-50", "cursor-pointer");

          row.innerHTML = `
            <td class="border border-zinc-300 px-4 py-2">${authorName}</td>
            <td class="border border-zinc-300 px-4 py-2">${groupedBooks[authorName]}</td>
          `;
          tableBody.appendChild(row);
        }
      });
    });
  });



  document.getElementById("yeseditInfodelete").addEventListener("click", async () => {
  try {
    // Retrieve the selected author's ID dynamically
    const selectedAuthorName = document.getElementById("selectedAuthor").textContent; // Replace with the actual element containing the author's name

    if (!selectedAuthorName) {
      console.error("No author selected.");
      return;
    }

    // Query Firestore to get the document ID for the selected author name
    const querySnapshot = await getDocs(query(authorsCollection, where("name", "==", selectedAuthorName)));

    if (querySnapshot.empty) {
      console.error("No author document found for the selected name:", selectedAuthorName);
      return;
    }

    // Assuming there is only one match for the author name
    const authorDocRef = querySnapshot.docs[0].ref;

    // Delete the author document
    await deleteDoc(authorDocRef);
    console.log("Author document deleted from archiveAuthors");

    // Wait for 2 seconds and then refresh the page
    setTimeout(() => {
      location.reload(); // Refreshes the page
    }, 2000);

  } catch (error) {
    console.error("Error deleting author document: ", error);
  }
});


  
  document.getElementById("books-table-body").addEventListener("click", async (event) => {
    const clickedRow = event.target.closest("tr");
    if (!clickedRow) return;

    // Clear any previous selection
    const previouslySelectedRow = document.querySelector("tr.selected-row");
    if (previouslySelectedRow) {
        previouslySelectedRow.classList.remove("selected-row");
    }

    // Highlight the clicked row
    clickedRow.classList.add("selected-row");

    const authorName = clickedRow.querySelector("td").textContent.trim();
    console.log(`Author clicked: ${authorName}`);

    // Show the update author modal
    const updateAuthorSection = document.getElementById("updateAuthor");
    updateAuthorSection.style.display = "block";

    // Fetch and display books authored by the selected author
    const booksQuery = query(booksCollection, where("archiveAuthors", "==", authorName));
    const booksSnapshot = await getDocs(booksQuery);

    const booksTableBody = document.getElementById("booksTableBody");
    booksTableBody.innerHTML = ""; // Clear the table body

    booksSnapshot.forEach((doc) => {
        const bookData = doc.data();
        const formattedDate = formatDate(bookData.uploadedAt);
        const row = `
          <tr style="color : white;">
            <td class="border border-zinc-300 px-4 py-2">${bookData.category}</td>
            <td class="border border-zinc-300 px-4 py-2">${bookData.bookId}</td>
            <td class="border border-zinc-300 px-4 py-2">${bookData.title}</td>
            <td class="border border-zinc-300 px-4 py-2">${bookData.authors}</td>
            <td class="border border-zinc-300 px-4 py-2">${bookData.publisher}</td>
            <td class="border border-zinc-300 px-4 py-2">${formattedDate}</td>
          </tr>
        `;
        booksTableBody.innerHTML += row;
    });
});


// Utility function to format date
function formatDate(timestamp) {
  const options = { year: "numeric", month: "long", day: "numeric", hour: "numeric", minute: "numeric", hour12: true };
  return new Date(timestamp).toLocaleString("en-US", options);
}


document.getElementById("confirmAuth").addEventListener("click", async () => {
  const updateAuthorSection = document.getElementById("updateAuthor");
  const oldAuthorName = document.querySelector("tr.selected-row td:first-child").textContent.trim(); // Assuming you mark the selected row with a class
  const newAuthorName = document.getElementById("authorNameInput").value.trim();


  try {
    // Step 1: Update the author's name in the authors collection
    const authorQuery = query(authorsCollection, where("authName", "==", oldAuthorName));
    const authorSnapshot = await getDocs(authorQuery);

    if (!authorSnapshot.empty) {
      const authorDocRef = authorSnapshot.docs[0].ref;
      await updateDoc(authorDocRef, { authName: newAuthorName });
      console.log(`Author updated in authors collection: ${oldAuthorName} -> ${newAuthorName}`);
    } else {
      console.error(`No author found with the name: ${oldAuthorName}`);
    }

    // Step 2: Update the author's name in the books collection
    const booksQuery = query(booksCollection, where("authors", "==", oldAuthorName));
    const booksSnapshot = await getDocs(booksQuery);

    const batch = writeBatch(db);
    booksSnapshot.forEach((bookDoc) => {
      batch.update(bookDoc.ref, { authors: newAuthorName });
    });
    await batch.commit();
    console.log(`Author updated in books collection for all books: ${oldAuthorName} -> ${newAuthorName}`);

    // Step 3: Hide the modal and refresh the table
    updateAuthorSection.style.display = "none";
r  } catch (error) {
    console.error("Error updating author name:", error);
  }
});
// Select the update section and its elements
const updateAuthorSection = document.getElementById("update-author-section");
const authorNameInput = document.getElementById("authorNameInput");
const authorCountryInput = document.getElementById("authorCountryInput");
const authorDobInput = document.getElementById("authorDobInput");

// Event listener for table rows
document.getElementById("books-table-body").addEventListener("click", (event) => {
    const clickedRow = event.target.closest("tr");
    if (!clickedRow) return;

    // Clear existing selection
    document.querySelectorAll(".selected-row").forEach(row => row.classList.remove("selected-row"));

    // Mark the clicked row as selected
    clickedRow.classList.add("selected-row");

   
    // Populate fields with the selected author's details
    const cells = clickedRow.querySelectorAll("td");
    authorNameInput.value = cells[0].textContent.trim();
    
});

// Event listener for update button

document.getElementById("confirmAuth").addEventListener("click", async () => {
    const updateAuthorSection = document.getElementById("updateAuthor");
    const oldAuthorName = document.querySelector("tr.selected-row td:first-child")?.textContent?.trim(); // Safe access
    const newAuthorName = document.getElementById("authorNameInput").value.trim();

 

    if (!oldAuthorName) {
        alert("No author selected to update.");
        return;
    }

    try {
        // Query books with the selected author's name
        const booksQuery = query(booksCollection, where("authors", "==", oldAuthorName));
        const booksSnapshot = await getDocs(booksQuery);

        if (booksSnapshot.empty) {
            console.log(`No author found with the name: ${oldAuthorName}`);
            return;
        }

        // Update the author's name using a batch operation
        const batch = writeBatch(db);
        booksSnapshot.forEach((bookDoc) => {
            batch.update(bookDoc.ref, { authors: newAuthorName });
        });
        await batch.commit();
        console.log(`Author updated: ${oldAuthorName} -> ${newAuthorName}`);

        updateAuthorSection.style.display = "none";
    } catch (error) {
        console.error("Error updating author name:", error);
        alert();
    }
});
document.getElementById("archiveAuthor").addEventListener("click", async () => {
    const oldAuthorName = document.querySelector("tr.selected-row td:first-child")?.textContent?.trim();

    if (!oldAuthorName) {
        alert("No author selected to archive.");
        return;
    }

    try {
        // Step 1: Query the author from the authors collection
        const authorQuery = query(authorsCollection, where("authName", "==", oldAuthorName));
        const authorSnapshot = await getDocs(authorQuery);

        if (authorSnapshot.empty) {
            alert(`No author found with the name: ${oldAuthorName}`);
            return;
        }

        const authorDocRef = authorSnapshot.docs[0].ref;
        const authorData = authorSnapshot.docs[0].data();

        // Step 2: Add the author to the archiveAuthors collection
        const archiveAuthorsCollection = collection(db, "authors");
        await addDoc(archiveAuthorsCollection, { ...authorData, archivedAt: new Date() });

        // Step 3: Delete the author from the authors collection
        await deleteDoc(authorDocRef);

        // Step 4: Handle books associated with the author
        const booksQuery = query(booksCollection, where("authors", "==", oldAuthorName));
        const booksSnapshot = await getDocs(booksQuery);

        if (!booksSnapshot.empty) {
            const batch = writeBatch(db);
            booksSnapshot.forEach((bookDoc) => {
                // Optionally, remove the author from the book's authors field or mark the book as "archived"
            });
            await batch.commit();
        }

        console.log(`Author archived: ${oldAuthorName}`);
        alert(`Author "${oldAuthorName}" has been archived.`);

        // Refresh the table
        const updateAuthorSection = document.getElementById("updateAuthor");
        updateAuthorSection.style.display = "none";

    } catch (error) {
        console.error("Error archiving author:", error);
        alert("An error occurred while archiving the author.");
    }
});



////////////////////////////////////////////////////////////////////////////////////////////////////////////////







document.addEventListener("DOMContentLoaded", () => {
  const archiveButton = document.getElementById("archive");
  if (archiveButton) {
    archiveButton.addEventListener("click", async () => {
      if (selectedBookId) {
        try {
          const bookDoc = doc(db, "books", selectedBookId);
          const bookData = (await getDoc(bookDoc)).data();

          if (bookData) {
            const archiveDoc = doc(db, "archive", selectedBookId);
            await setDoc(archiveDoc, bookData);
            await deleteDoc(bookDoc);

            document.getElementById("yeseditInfo").style.display = "none";
          } else {
            alert("Selected book data not found.");
          }
        } catch (error) {
          console.error("Error archiving book: ", error);
          alert("Failed to archive the book. Please try again.");
        }
      } else {
      }
    });
  }
});




document.getElementById('yeseditInfocancel').addEventListener('click', function () {
  // Hide the modal by setting its display to 'none'
  document.getElementById('updateAuthor').style.display = 'none';
});





//book row per page function







// upload books
// Handle image preview and compression
// Handle image preview and compression
document.getElementById("img").addEventListener("click", () => {
  document.getElementById("coverInput").click();
});

document.getElementById("coverInput").addEventListener("change", (event) => {
  const file = event.target.files[0];
  const preview = document.getElementById("cover-preview");
  
  if (file) {
    const reader = new FileReader();
    reader.onload = (e) => {
      const img = new Image();
      img.src = e.target.result;

      img.onload = () => {
        // Resize the image
        const canvas = document.createElement("canvas");
        const ctx = canvas.getContext("2d");

        const MAX_WIDTH = 200;
        const MAX_HEIGHT = 200;
        let width = img.width;
        let height = img.height;

        if (width > height) {
          if (width > MAX_WIDTH) {
            height *= MAX_WIDTH / width;
            width = MAX_WIDTH;
          }
        } else {
          if (height > MAX_HEIGHT) {
            width *= MAX_HEIGHT / height;
            height = MAX_HEIGHT;
          }
        }

        canvas.width = width;
        canvas.height = height;
        ctx.drawImage(img, 0, 0, width, height);

        // Replace preview with resized image
        const resizedImage = canvas.toDataURL("image/jpeg");
        preview.src = resizedImage;
        preview.classList.remove("hidden");
        document.getElementById("cover-text").classList.add("hidden");

        // Save the image data for upload
        window.resizedCoverImage = resizedImage;
      };
    };
    reader.readAsDataURL(file);
  } else {
    // If no image is uploaded, set a default image
    preview.src = ".../image/icons8-play-50.png";  // Default image
    preview.classList.remove("hidden");
    document.getElementById("cover-text").classList.add("hidden");
  }
});

// Upload book function with cover image
async function uploadBook() {
  try {
    // Get form data
    const bookData = {
      title: document.getElementById("title").value.trim(),
      mediaType: document.getElementById("mediaType").value,
      authors: document.getElementById("authors").value.trim(),
      isbn: document.getElementById("isbn").value.trim(),
      publisher: document.getElementById("publisher").value.trim(),
      subject: document.getElementById("subject").value.trim(),
      strandsCourses: document.getElementById("strandsCourses").value.trim(),
      category: document.getElementById("category").value,
      fullDescription: document.getElementById("fulldescription").value.trim(),
      year: document.getElementById("year").value.trim(),
      volume: document.getElementById("volume").value.trim(),
      pages: document.getElementById("pages").value.trim(),
      uploadedAt: new Date().toISOString(),
    };

    // Get the cover image or use the default if no image is uploaded
    let coverURL = ".../image/icons8-play-50.png";  // Default image
    if (window.resizedCoverImage) {
      const coverBlob = await (await fetch(window.resizedCoverImage)).blob();
      const coverRef = ref(storage, `books/${Date.now()}_cover.jpg`);
      await uploadBytes(coverRef, coverBlob);
      coverURL = await getDownloadURL(coverRef);
    }
    bookData.img = coverURL; // Add cover image URL to book data

    // Get the PDF file
    const pdfInput = document.getElementById("pdfLink");
    const pdfFile = pdfInput.files[0];

    if (!pdfFile) {
      alert("Please select a PDF file to upload.");
      return;
    }

    // Fetch current book count
    const booksCollection = collection(db, "books");
    const bookSnapshot = await getDocs(booksCollection);
    const bookCount = bookSnapshot.size + 1; // Calculate the next available number

    // Set bookId dynamically and ensure it's a string
    bookData.bookId = bookCount.toString();

    // Upload the PDF
    const pdfRef = ref(storage, `books/${pdfFile.name}`);
    await uploadBytes(pdfRef, pdfFile);
    const pdfURL = await getDownloadURL(pdfRef);

    bookData.pdfLink = pdfURL;

    // Add book data to Firestore with a string document ID
    const bookRef = doc(booksCollection, bookCount.toString());
    await setDoc(bookRef, bookData);

  } catch (error) {
    console.error("Error uploading book:", error);
    alert("Failed to upload book. Check console for details.");
  }
}

// Add event listener to "ADD" button
document.querySelector(".bg-primary").addEventListener("click", (event) => {
  event.preventDefault();
  uploadBook();
});










///////////////////////////////////////////````````````1//////////2222222222222;............STOP.......................STOP ...........
























function appendQueryParams(event) {
  event.preventDefault(); // Prevent default link behavior
  
  const uid = 'actualUID'; // Replace with actual UID value
  const url = new URL(event.target.href);
  
  url.searchParams.set('role', 'faculty');
  url.searchParams.set('uid', uid);
  
  // Update the link's href with the new URL
  event.target.href = url.href;

  // Optionally, navigate to the new URL
  window.location.href = url.href;
}

// Add event listener to the link (make sure the selector matches your link)
document.addEventListener('DOMContentLoaded', () => {
  const link = document.querySelector('a#your-link-id'); // Replace with actual link selector
  if (link) {
    link.addEventListener('click', appendQueryParams);
  }

  // Read query parameters from the URL
  const urlParams = new URLSearchParams(window.location.search);
  const role = urlParams.get('role');
  const uid = urlParams.get('uid');

  console.log("Role:", role);
  console.log("UID:", uid);
});
  </script>


</body>
</html>